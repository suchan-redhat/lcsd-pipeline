def listOfProjects = []
def GITTEA_HOST = "gitea-app-cicd.smartplay-np.lcsd.hksarg"
def GITTEA_PORT = "2222"
pipeline {
    agent
    {
        node {
                label 'maven'                
              }
    }
    stages
    {
        stage('Check Parameters') {
            steps {
                script {
                    if (!params.containsKey("JENKINS_FOLDER") 
                        ) {
                            //   GITEA_ORGANIZATION -> e.g. demo
                            //   GITEA_PROJECT -> e.g. springboot-helloworld
                            //   BUILD_AND_DEPLOY_TO_CONTAINER -> true
                            properties([
                                parameters([
                                    string(
                                        name: 'JENKINS_FOLDER',
                                        description: 'Jenkins Folder Name, should be smartplay',
                                        trim: true
                                    )
                                ])
                            ])
                        }
                    if (params.JENKINS_FOLDER.isEmpty()
                    ) {
                        error("Missing Mandatory Paramters")
                    }
                    
                }
            }
        }
        stage('checkout') {
            steps {
                checkout(
                    [
                        $class: 'GitSCM', branches: [[name: "${params.RELEASE_VERSION}"]],
                        userRemoteConfigs:[[credentialsId: 'GITEA-APPS-DEPLOY',
                        url:"ssh://git@${GITTEA_HOST}:${GITTEA_PORT}/demo/release"]]
                    ])                
            }
        }

        stage ('Read Release list') {
            steps {
                script {
                    def file = new File("release.txt" )
                    def lines = file.readLines()
                    for (line in lines) {
                        listOfProjects.add(line.split(":"))
                    }
                    echo "${listOfProjects}"
                }
            }
        }
        // stage ('Invoke_pipelineA') {
        //     steps {
        //         build job: 'pipelineA', parameters: [
        //         string(name: 'param1', value: "value1")
        //         ]
        //     }
        // }
    }
}